<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de usuarios</title>
</head>

<body>

  <header>
    <nav class="navbar navbar-expand-lg bg-danger bg-gradient">
      <div class="container-fluid">
        <a class="navbar-brand text-light fw-bold" href="#">Login</a>
      </div>
    </nav>
  </header>
  <main class="my-3">
    <form id="MainForm">
      <h2>REGISTRO</h2>
      <input id="emailInp" type="text" placeholder="email">
      <input id="passwordInp" type="password" placeholder="contrasena">
      <input id="nameInp" type="text" placeholder="nomber completo">
      <input id="secadorInp" type="number" min="1" max="4" placeholder="no. secador">
      <input id="turnoInp" type="text" placeholder="turno" maxlength="1">

      <button type="submit">Registrar</button>
      <br><br><br>
      <a href="login.html">Login</a>

    </form>
  </main>
  <footer class="bg-dark text-white">

  </footer>



  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase.js"></script>


  <!-- <script src="js/main.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>



  <script>

        // -- SDK FIREBASE  
        const firebaseConfig = {
      apiKey: "AIzaSyAXoDvbYkbX1Y-VuZmEjBTXv1BywK40Lmo",
      authDomain: "testappwebestadias.firebaseapp.com",
      databaseURL: "https://testappwebestadias-default-rtdb.firebaseio.com",
      projectId: "testappwebestadias",
      storageBucket: "testappwebestadias.appspot.com",
      messagingSenderId: "361048886546",
      appId: "1:361048886546:web:fde40acd0deeaaf207b7cb",
      measurementId: "G-FM5VLLCV3F"
    };

    // -- INICIALIZANDO LA BD
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // -- INICIALIZANDO LA BD
    // coleccionProduccion = db.ref().child('produccion');
    // import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    // import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
    // import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";


    // import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    // const firebaseConfig = {
    //   apiKey: "AIzaSyAXoDvbYkbX1Y-VuZmEjBTXv1BywK40Lmo",
    //   authDomain: "testappwebestadias.firebaseapp.com",
    //   databaseURL: "https://testappwebestadias-default-rtdb.firebaseio.com",
    //   projectId: "testappwebestadias",
    //   storageBucket: "testappwebestadias.appspot.com",
    //   messagingSenderId: "361048886546",
    //   appId: "1:361048886546:web:fde40acd0deeaaf207b7cb",
    //   measurementId: "G-FM5VLLCV3F"
    // };


    //     // -- INICIALIZANDO LA BD
    //     firebase.initializeApp(firebaseConfig);
    // const db = firebase.database();

    // -- INICIALIZANDO LA BD
    // coleccionProduccion = db.ref().child('produccion');

    // const app = initializeApp(firebaseConfig);
    // const analytics = getAnalytics(app);
    // const db = getDatabase();
    // const auth = getAuth(app);


    // coleccionUsers = db.ref().child('users');



    let MainForma = document.getElementById('MainForm');

    // VALIDACIONES

    
    

    // BOTON
    let RegisterUser = evt => {
      evt.preventDefault();
      
      let email = document.getElementById('emailInp').value;
    let password = document.getElementById('passwordInp').value;
    let name = document.getElementById('nameInp').value;
    let secador = document.getElementById('secadorInp').value;
    let turno = document.getElementById('turnoInp').value;


      if (validar_email(email) == false || validar_pass(password) == false) {
        alert('Correo y/o ContraseÃ±a incorrecto ->');
        return
      }
      
      
      if (validar_campo(name) == false || validar_campo(secador) == false || validar_campo(turno) == false) {
        alert('Uno o varios campos estan vacios');
      return
      }
      


      
      auth.createUserWithEmailAndPassword(email, password)
      .then(function() {
        // const users = userCredential.user;

        // DECLARAR VARIABLE USUARIO
        let user = auth.currentUser

        // AGREGAR USUARIO A LA BD
      let database_ref = db.ref();
      // let coleccionUsers;

      // CREAR LA INFORMACION DEL USUARIO
      var user_data = {
        email : email,
        name : name,
        secador : secador,
        turno : turno,
        last_login : Date.now()
      }

      database_ref.child('users/' + user.uid).set(user_data);
      // coleccionUsers + user.uid.set(user_data);





        alert("Usuario registrado");
      })
      .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;
        
        console.log(email + "<-email");
        console.log(password + "<-pass");


          alert(errorCode + ' error');
        });
    }

    MainForma.addEventListener('submit', RegisterUser);



    function validar_email(email) {
      let expression = /^[^@]+@\w+(\.\w+)+\w$/
      if (expression.test(email) == true) {
        return true;
      } else {
        return false;
      }
    }
    
    function validar_pass(password) {
      if (password <= 6) {
        return false;
      } else {
        return true;
      }
    }
    
    function validar_campo(field) {
      if (field == null) {
        return false;
      }
      if (field.lenght <= 0) {
        return false;
      } else {
        return true;
      }
    }
    

  </script>
</body>

</html>